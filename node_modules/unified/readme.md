# [![unified][logo]][site]

[![Build][build-badge]][build]
[![Coverage][coverage-badge]][coverage]
[![Downloads][downloads-badge]][downloads]
[![Size][size-badge]][size]
[![Sponsors][sponsors-badge]][collective]
[![Backers][backers-badge]][collective]
[![Chat][chat-badge]][chat]

**unified** lets you inspect and transform content with plugins.

## Contents

*   [What is this?](#what-is-this)
*   [When should I use this?](#when-should-i-use-this)
*   [Install](#install)
*   [Use](#use)
*   [Overview](#overview)
*   [API](#api)
    *   [`processor()`](#processor)
    *   [`processor.compiler`](#processorcompiler)
    *   [`processor.data([key[, value]])`](#processordatakey-value)
    *   [`processor.freeze()`](#processorfreeze)
    *   [`processor.parse(file)`](#processorparsefile)
    *   [`processor.parser`](#processorparser)
    *   [`processor.process(file[, done])`](#processorprocessfile-done)
    *   [`processor.processSync(file)`](#processorprocesssyncfile)
    *   [`processor.run(tree[, file][, done])`](#processorruntree-file-done)
    *   [`processor.runSync(tree[, file])`](#processorrunsynctree-file)
    *   [`processor.stringify(tree[, file])`](#processorstringifytree-file)
    *   [`processor.use(plugin[, options])`](#processoruseplugin-options)
    *   [`CompileResultMap`](#compileresultmap)
    *   [`CompileResults`](#compileresults)
    *   [`Compiler`](#compiler)
    *   [`Data`](#data)
    *   [`Parser`](#parser)
    *   [`Pluggable`](#pluggable)
    *   [`PluggableList`](#pluggablelist)
    *   [`Plugin`](#plugin)
    *   [`PluginTuple`](#plugintuple)
    *   [`Preset`](#preset)
    *   [`ProcessCallback`](#processcallback)
    *   [`Processor`](#processor-1)
    *   [`RunCallback`](#runcallback)
    *   [`Settings`](#settings)
    *   [`TransformCallback`](#transformcallback)
    *   [`Transformer`](#transformer)
*   [Types](#types)
*   [Compatibility](#compatibility)
*   [Contribute](#contribute)
*   [Sponsor](#sponsor)
*   [Acknowledgments](#acknowledgments)
*   [License](#license)

## What is this?

unified is two things:

*   **unified** is a collective of 500+ free and open source packages that work
    with content as structured data (ASTs)
*   `unified` (this project) is the core package, used in 1.3m+ projects on GH,
    to process content with plugins

Several ecosystems are built on unified around different kinds of content.
Notably, [remark][] (markdown), [rehype][] (HTML), and [retext][] (natural
language).
These ecosystems can be connected together.

*   for more about us, see [`unifiedjs.com`][site]
*   for updates, see [@unifiedjs][twitter] on Twitter
*   for questions, see [support][]
*   to help, see [contribute][] and [sponsor][] below

## When should I use this?

In some cases, you are already using unified.
For example, it‚Äôs used in MDX, Gatsby, Docusaurus, etc.
In those cases, you don‚Äôt need to add `unified` yourself but you can include
plugins into those projects.

But the real fun (for some) is to get your hands dirty and work with syntax
trees and build with it yourself.
You can create those projects, or things like Prettier, or your own site
generator.
You can connect utilities together and make your own plugins that check for
problems and transform from one thing to another.

When you are dealing with one type of content (such as markdown), you can use
the main package of that ecosystem instead (so `remark`).
When you are dealing with different kinds of content (such as markdown and
HTML), it‚Äôs recommended to use `unified` itself, and pick and choose the plugins
you need.

## Install

This package is [ESM only][esm].
In Node.js (version 16+), install with [npm][]:

```sh
npm install unified
```

In Deno with [`esm.sh`][esmsh]:

```js
import {unified} from 'https://esm.sh/unified@11'
```

In browsers with [`esm.sh`][esmsh]:

```html
<script type="module">
  import {unified} from 'https://esm.sh/unified@11?bundle'
</script>
```

## Use

```js
import rehypeDocument from 'rehype-document'
import rehypeFormat from 'rehype-format'
import rehypeStringify from 'rehype-stringify'
import remarkParse from 'remark-parse'
import remarkRehype from 'remark-rehype'
import {unified} from 'unified'
import {reporter} from 'vfile-reporter'

const file = await unified()
  .use(remarkParse)
  .use(remarkRehype)
  .use(rehypeDocument, {title: 'üëãüåç'})
  .use(rehypeFormat)
  .use(rehypeStringify)
  .process('# Hello world!')

console.error(reporter(file))
console.log(String(file))
```

Yields:

```txt
no issues found
```

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>üëãüåç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <h1>Hello world!</h1>
  </body>
</html>
```

<!-- Old name: -->

<a name="description"></a>

## Overview

`unified` is an interface for processing content with syntax trees.
Syntax trees are a representation of content understandable to programs.
Those programs, called *[plugins][api-plugin]*, take these trees and inspect and
modify them.
To get to the syntax tree from text, there is a *[parser][api-parser]*.
To get from that back to text, there is a *[compiler][api-compiler]*.
This is the *[process][api-process]* of a *processor*.

```ascii
| ........................ process ........................... |
| .......... parse ... | ... run ... | ... stringify ..........|

          +--------+                     +----------+
Input ->- | Parser | ->- Syntax Tree ->- | Compiler | ->- Output
          +--------+          |          +----------+
                              X
                              |
                       +--------------+
                       | Transformers |
                       +--------------+
```

###### Processors

Processors process content.
On its own, `unified` (the root processor) doesn‚Äôt work.
It needs to be configured with plugins to work.
For example:

```js
const processor = unified()
  .use(remarkParse)
  .use(remarkRehype)
  .use(rehypeDocument, {title: 'üëãüåç'})
  .use(rehypeFormat)
  .use(rehypeStringify)
```

That processor can do different things.
It can:

*   ‚Ä¶parse markdown (`parse`)
*   ‚Ä¶turn parsed markdown into HTML and format the HTML (`run`)
*   ‚Ä¶compile HTML (`stringify`)
*   ‚Ä¶do all of the above (`process`)

Every processor implements another processor.
To create a processor, call another processor.
The new processor is configured to work the same as its ancestor.
But when the descendant processor is configured in the future it does not affect
the ancestral processor.

When processors are exposed from a module (for example, `unified` itself) they
should not be configured directly, as that would change their behavior for all
module users.
Those processors are *[frozen][api-freeze]* and they should be called to create
a new processor before they are used.

###### File

When processing a document, metadata is gathered about that document.
[`vfile`][vfile] is the file format that stores data, metadata, and messages
about files for unified and plugins.

There are several [utilities][vfile-utilities] for working with these files.

###### Syntax tree

The syntax trees used in unified are [unist][] nodes.
A tree represents a whole document and each [node][] is a plain JavaScript
object with a `type` field.
The semantics of nodes and the format of syntax trees is defined by other
projects:

*   [esast][] ‚Äî JavaScript
*   [hast][] ‚Äî HTML
*   [mdast][] ‚Äî markdown
*   [nlcst][] ‚Äî natural language
*   [xast][] ‚Äî XML

There are many utilities for working with trees listed in each aforementioned
project and maintained in the [`syntax-tree`][syntax-tree] organization.
These utilities are a level lower than unified itself and are building blocks
that can be used to make plugins.

<!-- Old name: -->

<a name="list-of-processors"></a>

###### Ecosystems

Around each syntax tree is an ecosystem that focusses on that particular kind
of content.
At their core, they parse text to a tree and compile that tree back to text.
They also provide plugins that work with the syntax tree, without requiring
that the end user has knowledge about that tree.

*   [rehype][] (hast) ‚Äî HTML
*   [remark][] (mdast) ‚Äî markdown
*   [retext][] (nlcst) ‚Äî natural language

<a name="list-of-plugins"></a>

###### Plugins

Each aforementioned ecosystem comes with a large set of plugins that you can
pick and choose from to do all kinds of things.

*   [List of remark plugins][remark-plugins] ¬∑
    [`remarkjs/awesome-remark`][awesome-remark] ¬∑
    [`remark-plugin` topic][topic-remark-plugin]
*   [List of rehype plugins][rehype-plugins] ¬∑
    [`rehypejs/awesome-rehype`][awesome-rehype] ¬∑
    [`rehype-plugin` topic][topic-rehype-plugin]
*   [List of retext plugins][retext-plugins] ¬∑
    [`retextjs/awesome-retext`][awesome-retext] ¬∑
    [`retext-plugin` topic][topic-retext-plugin]

There are also a few plugins that work in any ecosystem:

*   [`unified-diff`](https://github.com/unifiedjs/unified-diff)
    ‚Äî ignore unrelated messages in GitHub Actions and Travis
*   [`unified-infer-git-meta`](https://github.com/unifiedjs/unified-infer-git-meta)
    ‚Äî infer metadata of a document from Git
*   [`unified-message-control`](https://github.com/unifiedjs/unified-message-control)
    ‚Äî enable, disable, and ignore messages from content

###### Configuration

Processors are configured with [plugins][api-plugin] or with the
[`data`][api-data] method.
Most plugins also accept configuration through options.
See each plugin‚Äôs readme for more info.

###### Integrations

unified can integrate with the file system through
[`unified-engine`][unified-engine].
CLI apps can be created with [`unified-args`][unified-args], Gulp plugins with
[`unified-engine-gulp`][unified-engine-gulp], and language servers with
[`unified-language-server`][unified-language-server].
A streaming interface can be created with [`unified-stream`][unified-stream].

###### Programming interface

The [API][] provided by `unified` allows multiple files to be processed and
gives access to metadata (such as lint messages):

```js
import rehypeStringify from 'rehype-stringify'
import remarkParse from 'remark-parse'
import remarkPresetLintMarkdownStyleGuide from 'remark-preset-lint-markdown-style-guide'
import remarkRehype from 'remark-rehype'
import remarkRetext from 'remark-retext'
import retextEnglish from 'retext-english'
import retextEquality from 'retext-equality'
import {unified} from 'unified'
import {reporter} from 'vfile-reporter'

const file = await unified()
  .use(remarkParse)
  .use(remarkPresetLintMarkdownStyleGuide)
  .use(remarkRetext, unified().use(retextEnglish).use(retextEquality))
  .use(remarkRehype)
  .use(rehypeStringify)
  .process('*Emphasis* and _stress_, you guys!')

console.error(reporter(file))
console.log(String(file))
```

Yields:

```txt
1:16-1:24 warning Emphasis should use `*` as a marker                                 emphasis-marker remark-lint
1:30-1:34 warning `guys` may be insensitive, use `people`, `persons`, `folks` instead gals-man        retext-equality

‚ö† 2 warnings
```

```html
<p><em>Emphasis</em> and <em>stress</em>, you guys!</p>
```

<!-- Old name: -->

<a name="processing-between-syntaxes"></a>

###### Transforming between ecosystems

Ecosystems can be combined in two modes.

**Bridge** mode transforms the tree from one format (*origin*) to another
(*destination*).
A different processor runs on the destination tree.
Afterwards, the original processor continues with the origin tree.

**Mutate** mode also transforms the syntax tree from one format to another.
But the original processor continues transforming the destination tree.

In the previous example (‚ÄúProgramming interface‚Äù), `remark-retext` is used in
bridge mode: the origin syntax tree is kept after retext is done; whereas
`remark-rehype` is used in mutate mode: it sets a new syntax tree and discards
the origin tree.

The following plugins lets you combine ecosystems:

*   [`remark-retext`][remark-retext] ‚Äî turn markdown into natural language
*   [`remark-rehype`][remark-rehype] ‚Äî turn markdown into HTML
*   [`rehype-retext`][rehype-retext] ‚Äî turn HTML into natural language
*   [`rehype-remark`][rehype-remark] ‚Äî turn HTML into markdown

## API

This package exports the identifier `unified` (the root `processor`).
There is no default export.

### `processor()`

Create a new processor.

###### Returns

New *[unfrozen][api-freeze]* processor ([`processor`][api-processor]).

This processor is configured to work the same as its ancestor.
When the descendant processor is configured in the future it does not affect
the ancestral processor.

###### Example

This example shows how a new processor can be created (from `remark`) and linked
to **stdin**(4) and **stdout**(4).

```js
import process from 'node:process'
import concatStream from 'concat-stream'
import {remark} from 'remark'

process.stdin.pipe(
  concatStream(function (buf) {
    process.stdout.write(String(remark().processSync(buf)))
  })
)
```

### `processor.compiler`

Compiler to use ([`Compiler`][api-compiler], optional).

### `processor.data([key[, value]])`

Configure the processor with info available to all plugins.
Information is stored in an object.

Typically, options can be given to a specific plugin, but sometimes it makes
sense to have information shared with several plugins.
For example, a list of HTML elements that are self-closing, which is needed
during all [phases][overview].

> üëâ **Note**: setting information cannot occur on *[frozen][api-freeze]*
> processors.
> Call the processor first to create a new unfrozen processor.

> üëâ **Note**: to register custom data in TypeScript, augment the
> [`Data`][api-data] interface.

###### Signatures

*   `processor = processor.data(key, value)`
*   `processor = processor.data(dataset)`
*   `value = processor.data(key)`
*   `dataset = processor.data()`

###### Parameters

*   `key` ([`keyof Data`][api-data], optional) ‚Äî field to get
*   `value` ([`Data[key]`][api-data]) ‚Äî value to set
*   `values` ([`Data`][api-data]) ‚Äî values to set

###### Returns

The current processor when setting ([`processor`][api-processor]), the value at
`key` when getting ([`Data[key]`][api-data]), or the entire dataset when
getting without key