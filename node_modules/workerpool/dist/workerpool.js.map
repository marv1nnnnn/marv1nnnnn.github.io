{"version":3,"file":"workerpool.js","sources":["../src/environment.js","../src/Promise.js","../src/validateOptions.js","../src/generated/embeddedWorker.js","../src/WorkerHandler.js","../src/debug-port-allocator.js","../src/Pool.js","../src/transfer.js","../src/worker.js","../src/index.js"],"sourcesContent":["\n// source: https://github.com/flexdinesh/browser-or-node\nvar isNode = function (nodeProcess) {\n  return (\n    typeof nodeProcess !== 'undefined' &&\n    nodeProcess.versions != null &&\n    nodeProcess.versions.node != null\n  );\n}\nmodule.exports.isNode = isNode\n\n// determines the JavaScript platform: browser or node\nmodule.exports.platform = typeof process !== 'undefined' && isNode(process)\n  ? 'node'\n  : 'browser';\n\n// determines whether the code is running in main thread or not\n// note that in node.js we have to check both worker_thread and child_process\nvar worker_threads = module.exports.platform === 'node' && require('worker_threads');\nmodule.exports.isMainThread = module.exports.platform === 'node'\n  ? ((!worker_threads || worker_threads.isMainThread) && !process.connected)\n  : typeof Window !== 'undefined';\n\n// determines the number of cpus available\nmodule.exports.cpus = module.exports.platform === 'browser'\n  ? self.navigator.hardwareConcurrency\n  : require('os').cpus().length;\n\n","'use strict';\n\n/**\n * Promise\n *\n * Inspired by https://gist.github.com/RubaXa/8501359 from RubaXa <trash@rubaxa.org>\n *\n * @param {Function} handler   Called as handler(resolve: Function, reject: Function)\n * @param {Promise} [parent]   Parent promise for propagation of cancel and timeout\n */\nfunction Promise(handler, parent) {\n  var me = this;\n\n  if (!(this instanceof Promise)) {\n    throw new SyntaxError('Constructor must be called with the new operator');\n  }\n\n  if (typeof handler !== 'function') {\n    throw new SyntaxError('Function parameter handler(resolve, reject) missing');\n  }\n\n  var _onSuccess = [];\n  var _onFail = [];\n\n  // status\n  this.resolved = false;\n  this.rejected = false;\n  this.pending = true;\n\n  /**\n   * Process onSuccess and onFail callbacks: add them to the queue.\n   * Once the promise is resolve, the function _promise is replace.\n   * @param {Function} onSuccess\n   * @param {Function} onFail\n   * @private\n   */\n  var _process = function (onSuccess, onFail) {\n    _onSuccess.push(onSuccess);\n    _onFail.push(onFail);\n  };\n\n  /**\n   * Add an onSuccess callback and optionally an onFail callback to the Promise\n   * @param {Function} onSuccess\n   * @param {Function} [onFail]\n   * @returns {Promise} promise\n   */\n  this.then = function (onSuccess, onFail) {\n    return new Promise(function (resolve, reject) {\n      var s = onSuccess ? _then(onSuccess, resolve, reject) : resolve;\n      var f = onFail    ? _then(onFail,    resolve, reject) : reject;\n\n      _process(s, f);\n    }, me);\n  };\n\n  /**\n   * Resolve the promise\n   * @param {*} result\n   * @type {Function}\n   */\n  var _resolve = function (result) {\n    // update status\n    me.resolved = true;\n    me.rejected = false;\n    me.pending = false;\n\n    _onSuccess.forEach(function (fn) {\n      fn(result);\n    });\n\n    _process = function (onSuccess, onFail) {\n      onSuccess(result);\n    };\n\n    _resolve = _reject = function () { };\n\n    return me;\n  };\n\n  /**\n   * Reject the promise\n   * @param {Error} error\n   * @type {Function}\n   */\n  var _reject = function (error) {\n    // update status\n    me.resolved = false;\n    me.rejected = true;\n    me.pending = false;\n\n    _onFail.forEach(function (fn) {\n      fn(error);\n    });\n\n    _process = function (onSuccess, onFail) {\n      onFail(error);\n    };\n\n    _resolve = _reject = function () { }\n\n    return me;\n  };\n\n  /**\n   * Cancel te promise. This will reject the promise with a CancellationError\n   * @returns {Promise} self\n   */\n  this.cancel = function () {\n    if (parent) {\n      parent.cancel();\n    }\n    else {\n      _reject(new CancellationError());\n    }\n\n    return me;\n  };\n\n  /**\n   * Set a timeout for the promise. If the promise is not resolved within\n   * the time, the promise will be cancelled and a TimeoutError is thrown.\n   * If the promise is resolved in time, the timeout is removed.\n   * @param {number} delay     Delay in milliseconds\n   * @returns {Promise} self\n   */\n  this.timeout = function (delay) {\n    if (parent) {\n      parent.timeout(delay);\n    }\n    else {\n      var timer = setTimeout(function () {\n        _reject(new TimeoutError('Promise timed out after ' + delay + ' ms'));\n      }, delay);\n\n      me.always(function () {\n        clearTimeout(timer);\n      });\n    }\n\n    return me;\n  };\n\n  // attach handler passing the resolve and reject functions\n  handler(function (result) {\n    _resolve(result);\n  }, function (error) {\n    _reject(error);\n  });\n}\n\n/**\n * Execute given callback, then call resolve/reject based on the returned result\n * @param {Function} callback\n * @param {Function} resolve\n * @param {Function} reject\n * @returns {Function}\n * @private\n */\nfunction _then(callback, resolve, reject) {\n  return function (result) {\n    try {\n      var res = callback(result);\n      if (res && typeof res.then === 'function' && typeof res['catch'] === 'function') {\n        // method returned a promise\n        res.then(resolve, reject);\n      }\n      else {\n        resolve(res);\n      }\n    }\n    catch (error) {\n      reject(error);\n    }\n  }\n}\n\n/**\n * Add an onFail callback to the Promise\n * @param {Function} onFail\n * @returns {Promise} promise\n */\nPromise.prototype['catch'] = function (onFail) {\n  return this.then(null, onFail);\n};\n\n// TODO: add support for Promise.catch(Error, callback)\n// TODO: add support for Promise.catch(Error, Error, callback)\n\n/**\n * Execute given callback when the promise either resolves or rejects.\n * @param {Function} fn\n * @returns {Promise} promise\n */\nPromise.prototype.always = function (fn) {\n  return this.then(fn, fn);\n};\n\n/**\n * Create a promise which resolves when all provided promises are resolved,\n * and fails when any of the promises resolves.\n * @param {Promise[]} promises\n * @returns {Promise} promise\n */\nPromise.all = function (promises){\n  return new Promise(function (resolve, reject) {\n    var remaining = promises.length,\n        results = [];\n\n    if (remaining) {\n      promises.forEach(function (p, i) {\n        p.then(function (result) {\n          results[i] = result;\n          remaining--;\n          if (remaining == 0) {\n            resolve(results);\n          }\n        }, function (error) {\n          remaining = 0;\n          reject(error);\n        });\n      });\n    }\n    else {\n      resolve(results);\n    }\n  });\n};\n\n/**\n * Create a promise resolver\n * @returns {{promise: Promise, resolve: Function, reject: Function}} resolver\n */\nPromise.defer = function () {\n  var resolver = {};\n\n  resolver.promise = new Promise(function (resolve, reject) {\n    resolver.resolve = resolve;\n    resolver.reject = reject;\n  });\n\n  return resolver;\n};\n\n/**\n * Create a cancellation error\n * @param {String} [message]\n * @extends Error\n */\nfunction CancellationError(message) {\n  this.message = message || 'promise cancelled';\n  this.stack = (new Error()).stack;\n}\n\nCancellationError.prototype = new Error();\nCancellationError.prototype.constructor = Error;\nCancellationError.prototype.name = 'CancellationError';\n\nPromise.CancellationError = CancellationError;\n\n\n/**\n * Create a timeout error\n * @param {String} [message]\n * @extends Error\n */\nfunction TimeoutError(message) {\n  this.message = message || 'timeout exceeded';\n  this.stack = (new Error()).stack;\n}\n\nTimeoutError.prototype = new Error();\nTimeoutError.prototype.constructor = Error;\nTimeoutError.prototype.name = 'TimeoutError';\n\nPromise.TimeoutError = TimeoutError;\n\n\nmodule.exports = Promise;\n","/**\n * Validate that the object only contains known option names\n * - Throws an error when unknown options are detected\n * - Throws an error when some of the allowed options are attached\n * @param {Object | undefined} options\n * @param {string[]} allowedOptionNames\n * @param {string} objectName\n * @retrun {Object} Returns the original options\n */\nexports.validateOptions = function validateOptions(options, allowedOptionNames, objectName) {\n  if (!options) {\n    return\n  }\n\n  var optionNames = options ?  Object.keys(options) : []\n\n  // check for unknown properties\n  var unknownOptionName = optionNames.find(optionName => !allowedOptionNames.includes(optionName))\n  if (unknownOptionName) {\n    throw new Error('Object \"' + objectName + '\" contains an unknown option \"' + unknownOptionName + '\"')\n  }\n\n  // check for inherited properties which are not present on the object itself\n  var illegalOptionName = allowedOptionNames.find(allowedOptionName => {\n    return Object.prototype[allowedOptionName] && !optionNames.includes(allowedOptionName)\n  })\n  if (illegalOptionName) {\n    throw new Error('Object \"' + objectName + '\" contains an inherited option \"' + illegalOptionName + '\" which is ' +\n      'not defined in the object itself but in its prototype. Only plain objects are allowed. ' +\n      'Please remove the option from the prototype or override it with a value \"undefined\".')\n  }\n\n  return options\n}\n\n// source: https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker\nexports.workerOptsNames = [\n  'credentials', 'name', 'type' ]\n\n// source: https://nodejs.org/api/child_process.html#child_processforkmodulepath-args-options\nexports.forkOptsNames = [\n  'cwd', 'detached', 'env', 'execPath', 'execArgv', 'gid', 'serialization',\n  'signal', 'killSignal', 'silent', 'stdio', 'uid', 'windowsVerbatimArguments',\n  'timeout'\n]\n\n// source: https://nodejs.org/api/worker_threads.html#new-workerfilename-options\nexports.workerThreadOptsNames = [\n  'argv', 'env', 'eval', 'execArgv', 'stdin', 'stdout', 'stderr', 'workerData',\n  'trackUnmanagedFds', 'transferList', 'resourceLimits', 'name'\n]\n","/**\n * embeddedWorker.js contains an embedded version of worker.js.\n * This file is automatically generated,\n * changes made in this file will be overwritten.\n */\nmodule.exports = \"!function(e,n){\\\"object\\\"==typeof exports&&\\\"undefined\\\"!=typeof module?module.exports=n():\\\"function\\\"==typeof define&&define.amd?define(n):(e=\\\"undefined\\\"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){\\\"use strict\\\";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,\\\"default\\\")?e.default:e}var n={};var t=function(e,n){this.message=e,this.transfer=n};return function(e){var n=t,r={exit:function(){}};if(\\\"undefined\\\"!=typeof self&&\\\"function\\\"==typeof postMessage&&\\\"function\\\"==typeof addEventListener)r.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},r.send=function(e){postMessage(e)};else{if(\\\"undefined\\\"==typeof process)throw new Error(\\\"Script must be executed as a worker\\\");var o;try{o=require(\\\"worker_threads\\\")}catch(e){if(\\\"object\\\"!=typeof e||null===e||\\\"MODULE_NOT_FOUND\\\"!==e.code)throw e}if(o&&null!==o.parentPort){var i=o.parentPort;r.send=i.postMessage.bind(i),r.on=i.on.bind(i),r.exit=process.exit.bind(process)}else r.on=process.on.bind(process),r.send=function(e){process.send(e)},r.on(\\\"disconnect\\\",(function(){process.exit(1)})),r.exit=process.exit.bind(process)}function s(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function d(e){return e&&\\\"function\\\"==typeof e.then&&\\\"function\\\"==typeof e.catch}r.methods={},r.methods.run=function(e,n){var t=new Function(\\\"return (\\\"+e+\\\").apply(null, arguments);\\\");return t.apply(t,n)},r.methods.methods=function(){return Object.keys(r.methods)},r.terminationHandler=void 0,r.cleanupAndExit=function(e){var n=function(){r.exit(e)};if(!r.terminationHandler)return n();var t=r.terminationHandler(e);d(t)?t.then(n,n):n()};var u=null;r.on(\\\"message\\\",(function(e){if(\\\"__workerpool-terminate__\\\"===e)return r.cleanupAndExit(0);try{var t=r.methods[e.method];if(!t)throw new Error('Unknown method \\\"'+e.method+'\\\"');u=e.id;var o=t.apply(t,e.params);d(o)?o.then((function(t){t instanceof n?r.send({id:e.id,result:t.message,error:null},t.transfer):r.send({id:e.id,result:t,error:null}),u=null})).catch((function(n){r.send({id:e.id,result:null,error:s(n)}),u=null})):(o instanceof n?r.send({id:e.id,result:o.message,error:null},o.transfer):r.send({id:e.id,result:o,error:null}),u=null)}catch(n){r.send({id:e.id,result:null,error:s(n)})}})),r.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(r.methods[t]=e[t]);n&&(r.terminationHandler=n.onTerminate),r.send(\\\"ready\\\")},r.emit=function(e){if(u){if(e instanceof n)return void r.send({id:u,isEvent:!0,payload:e.message},e.transfer);r.send({id:u,isEvent:!0,payload:e})}},e.add=r.register,e.emit=r.emit}(n),e(n)}));\\n//# sourceMappingURL=worker.min.js.map\\n\";\n","'use strict';\n\nvar Promise = require('./Promise');\nvar environment = require('./environment');\nconst {validateOptions, forkOptsNames, workerThreadOptsNames, workerOptsNames} = require(\"./validateOptions\");\n\n/**\n * Special message sent by parent which causes a child process worker to terminate itself.\n * Not a \"message object\"; this string is the entire message.\n */\nvar TERMINATE_METHOD_ID = '__workerpool-terminate__';\n\nfunction ensureWorkerThreads() {\n  var WorkerThreads = tryRequireWorkerThreads()\n  if (!WorkerThreads) {\n    throw new Error('WorkerPool: workerType = \\'thread\\' is not supported, Node >= 11.7.0 required')\n  }\n\n  return WorkerThreads;\n}\n\n// check whether Worker is supported by the browser\nfunction ensureWebWorker() {\n  // Workaround for a bug in PhantomJS (Or QtWebkit): https://github.com/ariya/phantomjs/issues/14534\n  if (typeof Worker !== 'function' && (typeof Worker !== 'object' || typeof Worker.prototype.constructor !== 'function')) {\n    throw new Error('WorkerPool: Web Workers not supported');\n  }\n}\n\nfunction tryRequireWorkerThreads() {\n  try {\n    return require('worker_threads');\n  } catch(error) {\n    if (typeof error === 'object' && error !== null && error.code === 'MODULE_NOT_FOUND') {\n      // no worker_threads available (old version of node.js)\n      return null;\n    } else {\n      throw error;\n    }\n  }\n}\n\n// get the default worker script\nfunction getDefaultWorker() {\n  if (environment.platform === 'browser') {\n    // test whether the browser supports all features that we need\n    if (typeof Blob === 'undefined') {\n      throw new Error('Blob not supported by the browser');\n    }\n    if (!window.URL || typeof window.URL.createObjectURL !== 'function') {\n      throw new Error('URL.createObjectURL not supported by the browser');\n    }\n\n    // use embedded worker.js\n    var blob = new Blob([require('./generated/embeddedWorker')], {type: 'text/javascript'});\n    return window.URL.createObjectURL(blob);\n  }\n  else {\n    // use external worker.js in current directory\n    return __dirname + '/worker.js';\n  }\n}\n\nfunction setupWorker(script, options) {\n  if (options.workerType === 'web') { // browser only\n    ensureWebWorker();\n    return setupBrowserWorker(script, options.workerOpts, Worker);\n  } else if (options.workerType === 'thread') { // node.js only\n    WorkerThreads = ensureWorkerThreads();\n    return setupWorkerThreadWorker(script, WorkerThreads, options.workerThreadOpts);\n  } else if (options.workerType === 'process' || !options.workerType) { // node.js only\n    return setupProcessWorker(script, resolveForkOptions(options), require('child_process'));\n  } else { // options.workerType === 'auto' or undefined\n    if (environment.platform === 'browser') {\n      ensureWebWorker();\n      return setupBrowserWorker(script, options.workerOpts, Worker);\n    }\n    else { // environment.platform === 'node'\n      var WorkerThreads = tryRequireWorkerThreads();\n      if (WorkerThreads) {\n        return setupWorkerThreadWorker(script, WorkerThreads, options.workerThreadOpts);\n      } else {\n        return setupProcessWorker(script, resolveForkOptions(options), require('child_process'));\n      }\n    }\n  }\n}\n\nfunction setupBrowserWorker(script, workerOpts, Worker) {\n  // validate the options right before creating the worker (not when creating the pool)\n  validateOptions(workerOpts, workerOptsNames, 'workerOpts')\n\n  // create the web worker\n  var worker = new Worker(script, workerOpts);\n\n  worker.isBrowserWorker = true;\n  // add node.js API to the web worker\n  worker.on = function (event, callback) {\n    this.addEventListener(event, function (message) {\n      callback(message.data);\n    });\n  };\n  worker.send = function (message, transfer) {\n    this.postMessage(message, transfer);\n  };\n  return worker;\n}\n\nfunction setupWorkerThreadWorker(script, WorkerThreads, workerThreadOptions) {\n  // validate the options right before creating the worker thread (not when creating the pool)\n  validateOptions(workerThreadOptions, workerThreadOptsNames, 'workerThreadOpts')\n\n  var worker = new WorkerThreads.Worker(script, {\n    stdout: false, // automatically pipe worker.STDOUT to process.STDOUT\n    stderr: false,  // automatically pipe worker.STDERR to process.STDERR\n    ...workerThreadOptions\n  });\n  worker.isWorkerThread = true;\n  worker.send = function(message, transfer) {\n    this.postMessage(message, transfer);\n  };\n\n  worker.kill = function() {\n    this.terminate();\n    return true;\n  };\n\n  worker.disconnect = function() {\n    this.terminate();\n  };\n\n  return worker;\n}\n\nfunction setupProcessWorker(script, options, child_process) {\n  // validate the options right before creating the child process (not when creating the pool)\n  validateOptions(options.forkOpts, forkOptsNames, 'forkOpts')\n\n  // no WorkerThreads, fallback to sub-process based workers\n  var worker = child_process.fork(\n    script,\n    options.forkArgs,\n    options.forkOpts\n  );\n\n  // ignore transfer argument since it is not supported by process\n  var send = worker.send;\n  worker.send = function (message) {\n    return send.call(worker, message);\n  };\n\n  worker.isChildProcess = true;\n  return worker;\n}\n\n// add debug flags to child processes if the node inspector is active\nfunction resolveForkOptions(opts) {\n  opts = opts || {};\n\n  var processExecArgv = process.execArgv.join(' ');\n  var inspectorActive = processExecArgv.indexOf('--inspect') !== -1;\n  var debugBrk = processExecArgv.indexOf('--debug-brk') !== -1;\n\n  var execArgv = [];\n  if (inspectorActive) {\n    execArgv.push('--inspect=' + opts.debugPort);\n\n    if (debugBrk) {\n      execArgv.push('--debug-brk');\n    }\n  }\n\n  process.execArgv.forEach(function(arg) {\n    if (arg.indexOf('--max-old-space-size') > -1) {\n      execArgv.push(arg)\n    }\n  })\n\n  return Object.assign({}, opts, {\n    forkArgs: opts.forkArgs,\n    forkOpts: Object.assign({}, opts.forkOpts, {\n      execArgv: (opts.forkOpts && opts.forkOpts.execArgv || [])\n      .concat(execArgv)\n    })\n  });\n}\n\n/**\n * Converts a serialized error to Error\n * @param {Object} obj Error that has been serialized and parsed to object\n * @return {Error} The equivalent Error.\n */\nfunction objectToError (obj) {\n  var temp = new Error('')\n  var props = Object.keys(obj)\n\n  for (var i = 0; i < props.length; i++) {\n    temp[props[i]] = obj[props[i]]\n  }\n\n  return temp\n}\n\n/**\n * A WorkerHandler controls a single worker. This worker can be a child process\n * on node.js or a WebWorker in a browser environment.\n * @param {String} [script] If no script is provided, a default worker with a\n *                          function run will be created.\n * @param {WorkerPoolOptions} _options See docs\n * @constructor\n */\nfunction WorkerHandler(script, _options) {\n  var me = this;\n  var options = _options || {};\n\n  this.script = script || getDefaultWorker();\n  this.worker = setupWorker(this.script, options);\n  this.debugPort = options.debugPort;\n  this.forkOpts = options.forkOpts;\n  this.forkArgs = options.forkArgs;\n  this.workerOpts = options.workerOpts;\n  this.workerThreadOpts = options.workerThreadOpts\n  this.workerTerminateTimeout = options.workerTerminateTimeout;\n\n  // The ready message is only sent if the worker.add method is called (And the default script is not used)\n  if (!script) {\n    this.worker.ready = true;\n  }\n\n  // queue for requests that are received before the worker is ready\n  this.requestQueue = [];\n  this.worker.on('message', function (response) {\n    if (me.terminated) {\n      return;\n    }\n    if (typeof response === 'string' && response === 'ready') {\n      me.worker.ready = true;\n      dispatchQueuedRequests();\n    } else {\n      // find the task from the processing queue, and run the tasks callback\n      var id = response.id;\n      var task = me.processing[id];\n      if (task !== undefined) {\n        if (response.isEvent) {\n          if (task.options && typeof task.options.on === 'function') {\n            task.options.on(response.payload);\n          }\n        } else {\n          // remove the task from the queue\n          delete me.processing[id];\n\n          // test if we need to terminate\n          if (me.terminating === true) {\n            // complete worker termination if all tasks are finished\n            me.terminate();\n          }\n\n          // resolve the task's promise\n          if (response.error) {\n            task.resolver.reject(objectToError(response.error));\n          }\n          else {\n            task.resolver.resolve(response.result);\n          }\n        }\n      }\n    }\n  });\n\n  // reject all running tasks on worker error\n  function onError(error) {\n    me.terminated = true;\n\n    for (var id in me.processing) {\n      if (me.processing[id] !== undefined) {\n        me.processing[id].resolver.reject(error);\n      }\n    }\n    me.processing = Object.create(null);\n  }\n\n  // send all queued requests to worker\n  function dispatchQueuedRequests()\n  {\n    for(const request of me.requestQueue.splice(0)) {\n      me.worker.send(request.message, request.transfer);\n    }\n  }\n\n  var worker = this.worker;\n  // listen for worker messages error and exit\n  this.worker.on('error', onError);\n  this.worker.on('exit', function (exitCode, signalCode) {\n    var message = 'Workerpool Worker terminated Unexpectedly\\n';\n\n    message += '    exitCode: `' + exitCode + '`\\n';\n    message += '    signalCode: `' + signalCode + '`\\n';\n\n    message += '    workerpool.script: `' +  me.script + '`\\n';\n    message += '    spawnArgs: `' +  worker.spawnargs + '`\\n';\n    message += '    spawnfile: `' + worker.spawnfile + '`\\n'\n\n    message += '    stdout: `' + worker.stdout + '`\\n'\n    message += '    stderr: `' + worker.stderr + '`\\n'\n\n    onError(new Error(message));\n  });\n\n  this.processing = Object.create(null); // queue with tasks currently in progress\n\n  this.terminating = false;\n  this.terminated = false;\n  this.cleaning = false;\n  this.terminationHandler = null;\n  this.lastId = 0;\n}\n\n/**\n * Get a list with methods available on the worker.\n * @return {Promise.<String[], Error>} methods\n */\nWorkerHandler.prototype.methods = function () {\n  return this.exec('methods');\n};\n\n/**\n * Execute a method with given parameters on the worker\n * @param {String} method\n * @param {Array} [params]\n * @param {{resolve: Function, reject: Function}} [resolver]\n * @param {ExecOptions}  [options]\n * @return {Promise.<*, Error>} result\n */\nWorkerHandler.prototype.exec = function(method, params, resolver, options) {\n  if (!resolver) {\n    resolver = Promise.defer();\n  }\n\n  // generate a unique id for the task\n  var id = ++this.lastId;\n\n  // register a new task as being in progress\n  this.processing[id] = {\n    id: id,\n    resolver: resolver,\n    options: options\n  };\n\n  // build a JSON-RPC request\n  var request = {\n    message: {\n      id: id,\n      method: method,\n      params: params\n    },\n    transfer: options && options.transfer\n  };\n\n  if (this.terminated) {\n    resolver.reject(new Error('Worker is terminated'));\n  } else if (this.worker.ready) {\n    // send the request to the worker\n    this.worker.send(request.message, request.transfer);\n  } else {\n    this.requestQueue.push(request);\n  }\n\n  // on cancellation, force the worker to terminate\n  var me = this;\n  return resolver.promise.catch(function (error) {\n    if (error instanceof Promise.CancellationError || error instanceof Promise.TimeoutError) {\n      // remove this task from the queue. It is already rejected (hence this\n      // catch event), and else it will be rejected again when terminating\n      delete me.processing[id];\n\n      // terminate worker\n      return me.terminateAndNotify(true)\n        .then(function() {\n          throw error;\n        }, function(err) {\n          throw err;\n        });\n    } else {\n      throw error;\n    }\n  })\n};\n\n/**\n * Test whether the worker is processing any tasks or cleaning up before termination.\n * @return {boolean} Returns true if the worker is busy\n */\nWorkerHandler.prototype.busy = function () {\n  return this.cleaning || Object.keys(this.processing).length > 0;\n};\n\n/**\n * Terminate the worker.\n * @param {boolean} [force=false]   If false (default), the worker is terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the worker will be\n *                                  terminated immediately.\n * @param {function} [callback=null] If provided, will be called when process terminates.\n */\nWorkerHandler.prototype.terminate = function (force, callback) {\n  var me = this;\n  if (force) {\n    // cancel all tasks in progress\n    for (var id in this.processing) {\n      if (this.processing[id] !== undefined) {\n        this.processing[id].resolver.reject(new Error('Worker terminated'));\n      }\n    }\n    this.processing = Object.create(null);\n  }\n\n  if (typeof callback === 'function') {\n    this.terminationHandler = callback;\n  }\n  if (!this.busy()) {\n    // all tasks are finished. kill the worker\n    var cleanup = function(err) {\n      me.terminated = true;\n      me.cleaning = false;\n      if (me.worker != null && me.worker.removeAllListeners) {\n        // removeAllListeners is only available for child_process\n        me.worker.removeAllListeners('message');\n      }\n      me.worker = null;\n      me.terminating = false;\n      if (me.terminationHandler) {\n        me.terminationHandler(err, me);\n      } else if (err) {\n        throw err;\n      }\n    }\n\n    if (this.worker) {\n      if (typeof this.worker.kill === 'function') {\n        if (this.worker.killed) {\n          cleanup(new Error('worker already killed!'));\n          return;\n        }\n\n        // child process and worker threads\n        var cleanExitTimeout = setTimeout(function() {\n          if (me.worker) {\n            me.worker.kill();\n          }\n        }, this.workerTerminateTimeout);\n\n        this.worker.once('exit', function() {\n          clearTimeout(cleanExitTimeout);\n          if (me.worker) {\n            me.worker.killed = true;\n          }\n          cleanup();\n        });\n\n        if (this.worker.ready) {\n          this.worker.send(TERMINATE_METHOD_ID);\n        } else {\n          this.requestQueue.push({ message: TERMINATE_METHOD_ID });\n        }\n\n        // mark that the worker is cleaning up resources\n        // to prevent new tasks from being executed\n        this.cleaning = true;\n        return;\n      }\n      else if (typeof this.worker.terminate === 'function') {\n        this.worker.terminate(); // web worker\n        this.worker.killed = true;\n      }\n      else {\n        throw new Error('Failed to terminate worker');\n      }\n    }\n    cleanup();\n  }\n  else {\n    // we can't terminate immediately, there are still tasks being executed\n    this.terminating = true;\n  }\n};\n\n/**\n * Terminate the worker, returning a Promise that resolves when the termination has been done.\n * @param {boolean} [force=false]   If false (default), the worker is terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the worker will be\n *                                  terminated immediately.\n * @param {number} [timeout]        If provided and non-zero, worker termination promise will be rejected\n *                                  after timeout if worker process has not been terminated.\n * @return {Promise.<WorkerHandler, Error>}\n */\nWorkerHandler.prototype.terminateAndNotify = function (force, timeout) {\n  var resolver = Promise.defer();\n  if (timeout) {\n    resolver.promise.timeout(timeout);\n  }\n  this.terminate(force, function(err, worker) {\n    if (err) {\n      resolver.reject(err);\n    } else {\n      resolver.resolve(worker);\n    }\n  });\n  return resolver.promise;\n};\n\nmodule.exports = WorkerHandler;\nmodule.exports._tryRequireWorkerThreads = tryRequireWorkerThreads;\nmodule.exports._setupProcessWorker = setupProcessWorker;\nmodule.exports._setupBrowserWorker = setupBrowserWorker;\nmodule.exports._setupWorkerThreadWorker = setupWorkerThreadWorker;\nmodule.exports.ensureWorkerThreads = ensureWorkerThreads;\n","'use strict';\n\nvar MAX_PORTS = 65535;\nmodule.exports = DebugPortAllocator;\nfunction DebugPortAllocator() {\n  this.ports = Object.create(null);\n  this.length = 0;\n}\n\nDebugPortAllocator.prototype.nextAvailableStartingAt = function(starting) {\n  while (this.ports[starting] === true) {\n    starting++;\n  }\n\n  if (starting >= MAX_PORTS) {\n    throw new Error('WorkerPool debug port limit reached: ' + starting + '>= ' + MAX_PORTS );\n  }\n\n  this.ports[starting] = true;\n  this.length++;\n  return starting;\n};\n\nDebugPortAllocator.prototype.releasePort = function(port) {\n  delete this.ports[port];\n  this.length--;\n};\n\n","var Promise = require('./Promise');\nvar WorkerHandler = require('./WorkerHandler');\nvar environment = require('./environment');\nvar DebugPortAllocator = require('./debug-port-allocator');\nvar DEBUG_PORT_ALLOCATOR = new DebugPortAllocator();\n/**\n * A pool to manage workers\n * @param {String} [script]   Optional worker script\n * @param {WorkerPoolOptions} [options]  See docs\n * @constructor\n */\nfunction Pool(script, options) {\n  if (typeof script === 'string') {\n    this.script = script || null;\n  }\n  else {\n    this.script = null;\n    options = script;\n  }\n\n  this.workers = [];  // queue with all workers\n  this.tasks = [];    // queue with tasks awaiting execution\n\n  options = options || {};\n\n  this.forkArgs = Object.freeze(options.forkArgs || []);\n  this.forkOpts = Object.freeze(options.forkOpts || {});\n  this.workerOpts = Object.freeze(options.workerOpts || {});\n  this.workerThreadOpts = Object.freeze(options.workerThreadOpts || {})\n  this.debugPortStart = (options.debugPortStart || 43210);\n  this.nodeWorker = options.nodeWorker;\n  this.workerType = options.workerType || options.nodeWorker || 'auto'\n  this.maxQueueSize = options.maxQueueSize || Infinity;\n  this.workerTerminateTimeout = options.workerTerminateTimeout || 1000;\n\n  this.onCreateWorker = options.onCreateWorker || (() => null);\n  this.onTerminateWorker = options.onTerminateWorker || (() => null);\n\n  // configuration\n  if (options && 'maxWorkers' in options) {\n    validateMaxWorkers(options.maxWorkers);\n    this.maxWorkers = options.maxWorkers;\n  }\n  else {\n    this.maxWorkers = Math.max((environment.cpus || 4) - 1, 1);\n  }\n\n  if (options && 'minWorkers' in options) {\n    if(options.minWorkers === 'max') {\n      this.minWorkers = this.maxWorkers;\n    } else {\n      validateMinWorkers(options.minWorkers);\n      this.minWorkers = options.minWorkers;\n      this.maxWorkers = Math.max(this.minWorkers, this.maxWorkers);     // in case minWorkers is higher than maxWorkers\n    }\n    this._ensureMinWorkers();\n  }\n\n  this._boundNext = this._next.bind(this);\n\n\n  if (this.workerType === 'thread') {\n    WorkerHandler.ensureWorkerThreads();\n  }\n}\n\n\n/**\n * Execute a function on a worker.\n *\n * Example usage:\n *\n *   var pool = new Pool()\n *\n *   // call a function available on the worker\n *   pool.exec('fibonacci', [6])\n *\n *   // offload a function\n *   function add(a, b) {\n *     return a + b\n *   };\n *   pool.exec(add, [2, 4])\n *       .then(function (result) {\n *         console.log(result); // outputs 6\n *       })\n *       .catch(function(error) {\n *         console.log(error);\n *       });\n *\n * @param {String | Function} method  Function name or function.\n *                                    If `method` is a string, the corresponding\n *                                    method on the worker will be executed\n *                                    If `method` is a Function, the function\n *                                    will be stringified and executed via the\n *                                    workers built-in function `run(fn, args)`.\n * @param {Array} [params]  Function arguments applied when calling the function\n * @param {ExecOptions} [options]  Options object\n * @return {Promise.<*, Error>} result\n */\nPool.prototype.exec = function (method, params, options) {\n  // validate type of arguments\n  if (params && !Array.isArray(params)) {\n    throw new TypeError('Array expected as argument \"params\"');\n  }\n\n  if (typeof method === 'string') {\n    var resolver = Promise.defer();\n\n    if (this.tasks.length >= this.maxQueueSize) {\n      throw new Error('Max queue size of ' + this.maxQueueSize + ' reached');\n    }\n\n    // add a new task to the queue\n    var tasks = this.tasks;\n    var task = {\n      method:  method,\n      params:  params,\n      resolver: resolver,\n      timeout: null,\n      options: options\n    };\n    tasks.push(task);\n\n    // replace the timeout method of the Promise with our own,\n    // which starts the timer as soon as the task is actually started\n    var originalTimeout = resolver.promise.timeout;\n    resolver.promise.timeout = function timeout (delay) {\n      if (tasks.indexOf(task) !== -1) {\n        // task is still queued -> start the timer later on\n        task.timeout = delay;\n        return resolver.promise;\n      }\n      else {\n        // task is already being executed -> start timer immediately\n        return originalTimeout.call(resolver.promise, delay);\n      }\n    };\n\n    // trigger task execution\n    this._next();\n\n    return resolver.promise;\n  }\n  else if (typeof method === 'function') {\n    // send stringified function and function arguments to worker\n    return this.exec('run', [String(method), params]);\n  }\n  else {\n    throw new TypeError('Function or string expected as argument \"method\"');\n  }\n};\n\n/**\n * Create a proxy for current worker. Returns an object containing all\n * methods available on the worker. The methods always return a promise.\n *\n * @return {Promise.<Object, Error>} proxy\n */\nPool.prototype.proxy = function () {\n  if (arguments.length > 0) {\n    throw new Error('No arguments expected');\n  }\n\n  var pool = this;\n  return this.exec('methods')\n      .then(function (methods) {\n        var proxy = {};\n\n        methods.forEach(function (method) {\n          proxy[method] = function () {\n            return pool.exec(method, Array.prototype.slice.call(arguments));\n          }\n        });\n\n        return proxy;\n      });\n};\n\n/**\n * Creates new array with the results of calling a provided callback function\n * on every element in this array.\n * @param {Array} array\n * @param {function} callback  Function taking two arguments:\n *                             `callback(currentValue, index)`\n * @return {Promise.<Array>} Returns a promise which resolves  with an Array\n *                           containing the results of the callback function\n *                           executed for each of the array elements.\n */\n/* TODO: implement map\nPool.prototype.map = function (array, callback) {\n};\n*/\n\n/**\n * Grab the first task from the queue, find a free worker, and assign the\n * worker to the task.\n * @protected\n */\nPool.prototype._next = function () {\n  if (this.tasks.length > 0) {\n    // there are tasks in the queue\n\n    // find an available worker\n    var worker = this._getWorker();\n    if (worker) {\n      // get the first task from the queue\n      var me = this;\n      var task = this.tasks.shift();\n\n      // check if the task is still pending (and not cancelled -> promise rejected)\n      if (task.resolver.promise.pending) {\n        // send the request to the worker\n        var promise = worker.exec(task.method, task.params, task.resolver, task.options)\n          .then(me._boundNext)\n          .catch(function () {\n            // if the worker crashed and terminated, remove it from the pool\n            if (worker.terminated) {\n              return me._removeWorker(worker);\n            }\n          }).then(function() {\n            me._next(); // trigger next task in the queue\n          });\n\n        // start queued timer now\n        if (typeof task.timeout === 'number') {\n          promise.timeout(task.timeout);\n        }\n      } else {\n        // The task taken was already complete (either rejected or resolved), so just trigger next task in the queue\n        me._next();\n      }\n    }\n  }\n};\n\n/**\n * Get an available worker. If no worker is available and the maximum number\n * of workers isn't yet reached, a new worker will be created and returned.\n * If no worker is available and the maximum number of workers is reached,\n * null will be returned.\n *\n * @return {WorkerHandler | null} worker\n * @private\n */\nPool.prototype._getWorker = function() {\n  // find a non-busy worker\n  var workers = this.workers;\n  for (var i = 0; i < workers.length; i++) {\n    var worker = workers[i];\n    if (worker.busy() === false) {\n      return worker;\n    }\n  }\n\n  if (workers.length < this.maxWorkers) {\n    // create a new worker\n    worker = this._createWorkerHandler();\n    workers.push(worker);\n    return worker;\n  }\n\n  return null;\n};\n\n/**\n * Remove a worker from the pool.\n * Attempts to terminate worker if not already terminated, and ensures the minimum\n * pool size is met.\n * @param {WorkerHandler} worker\n * @return {Promise<WorkerHandler>}\n * @protected\n */\nPool.prototype._removeWorker = function(worker) {\n  var me = this;\n\n  DEBUG_PORT_ALLOCATOR.releasePort(worker.debugPort);\n  // _removeWorker will call this, but we need it to be removed synchronously\n  this._removeWorkerFromList(worker);\n  // If minWorkers set, spin up new workers to replace the crashed ones\n  this._ensureMinWorkers();\n  // terminate the worker (if not already terminated)\n  return new Promise(function(resolve, reject) {\n    worker.terminate(false, function(err) {\n      me.onTerminateWorker({\n        forkArgs: worker.forkArgs,\n        forkOpts: worker.forkOpts,\n        workerThreadOpts: worker.workerThreadOpts,\n        script: worker.script\n      });\n      if (err) {\n        reject(err);\n      } else {\n        resolve(worker);\n      }\n    });\n  });\n};\n\n/**\n * Remove a worker from the pool list.\n * @param {WorkerHandler} worker\n * @protected\n */\nPool.prototype._removeWorkerFromList = function(worker) {\n  // remove from the list with workers\n  var index = this.workers.indexOf(worker);\n  if (index !== -1) {\n    this.workers.splice(index, 1);\n  }\n};\n\n/**\n * Close all active workers. Tasks currently being executed will be finished first.\n * @param {boolean} [force=false]   If false (default), the workers are terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the workers will be\n *                                  terminated immediately.\n * @param {number} [timeout]        If provided and non-zero, worker termination promise will be rejected\n *                                  after timeout if worker process has not been terminated.\n * @return {Promise.<void, Error>}\n */\nPool.prototype.terminate = function (force, timeout) {\n  var me = this;\n\n  // cancel any pending tasks\n  this.tasks.forEach(function (task) {\n    task.resolver.reject(new Error('Pool terminated'));\n  });\n  this.tasks.length = 0;\n\n  var f = function (worker) {\n    DEBUG_PORT_ALLOCATOR.releasePort(worker.debugPort);\n    this._removeWorkerFromList(worker);\n  };\n  var removeWorker = f.bind(this);\n\n  var promises = [];\n  var workers = this.workers.slice();\n  workers.forEach(function (worker) {\n    var termPromise = worker.terminateAndNotify(force, timeout)\n      .then(removeWorker)\n      .always(function() {\n        me.onTerminateWorker({\n          forkArgs: worker.forkArgs,\n          forkOpts: worker.forkOpts,\n          workerThreadOpts: worker.workerThreadOpts,\n          script: worker.script\n        });\n      });\n    promises.push(termPromise);\n  });\n  return Promise.all(promises);\n};\n\n/**\n * Retrieve statistics on tasks and workers.\n * @return {{totalWorkers: number, busyWorkers: number, idleWorkers: number, pendingTasks: number, activeTasks: number}} Returns an object with statistics\n */\nPool.prototype.stats = function () {\n  var totalWorkers = this.workers.length;\n  var busyWorkers = this.workers.filter(function (worker) {\n    return worker.busy();\n  }).length;\n\n  return {\n    totalWorkers:  totalWorkers,\n    busyWorkers:   busyWorkers,\n    idleWorkers:   totalWorkers - busyWorkers,\n\n    pendingTasks:  this.tasks.length,\n    activeTasks:   busyWorkers\n  };\n};\n\n/**\n * Ensures that a minimum of minWorkers is up and running\n * @protected\n */\nPool.prototype._ensureMinWorkers = function() {\n  if (this.minWorkers) {\n    for(var i = this.workers.length; i < this.minWorkers; i++) {\n      this.workers.push(this._createWorkerHandler());\n    }\n  }\n};\n\n/**\n * Helper function to create a new WorkerHandler and pass all options.\n * @return {WorkerHandler}\n * @private\n */\nPool.prototype._createWorkerHandler = function () {\n  const overriddenParams = this.onCreateWorker({\n    forkArgs: this.forkArgs,\n    forkOpts: this.forkOpts,\n    workerOpts: this.workerOpts,\n    workerThreadOpts: this.workerThreadOpts,\n    script: this.script\n  }) || {};\n\n  return new WorkerHandler(overriddenParams.script || this.script, {\n    forkArgs: overriddenParams.forkArgs || this.forkArgs,\n    forkOpts: overriddenParams.forkOpts || this.forkOpts,\n    workerOpts: overriddenParams.workerOpts || this.workerOpts,\n    workerThreadOpts: overriddenParams.workerThreadOpts || this.workerThreadOpts,\n    debugPort: DEBUG_PORT_ALLOCATOR.nextAvailableStartingAt(this.debugPortStart),\n    workerType: this.workerType,\n    workerTerminateTimeout: this.workerTerminateTimeout,\n  });\n}\n\n/**\n * Ensure that the maxWorkers option is an integer >= 1\n * @param {*} maxWorkers\n * @returns {boolean} returns true maxWorkers has a valid value\n */\nfunction validateMaxWorkers(maxWorkers) {\n  if (!isNumber(maxWorkers) || !isInteger(maxWorkers) || maxWorkers < 1) {\n    throw new TypeError('Option maxWorkers must be an integer number >= 1');\n  }\n}\n\n/**\n * Ensure that the minWorkers option is an integer >= 0\n * @param {*} minWorkers\n * @returns {boolean} returns true when minWorkers has a valid value\n */\nfunction validateMinWorkers(minWorkers) {\n  if (!isNumber(minWorkers) || !isInteger(minWorkers) || minWorkers < 0) {\n    throw new TypeError('Option minWorkers must be an integer number >= 0');\n  }\n}\n\n/**\n * Test whether a variable is a number\n * @param {*} value\n * @returns {boolean} returns true when value is a number\n */\nfunction isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Test whether a number is an integer\n * @param {number} value\n * @returns {boolean} Returns true if value is an integer\n */\nfunction isInteger(value) {\n  return Math.round(value) == value;\n}\n\nmodule.exports = Pool;\n","/**\n * The helper class for transferring data from the worker to the main thread.\n *\n * @param {Object} message The object to deliver to the main thread.\n * @param {Object[]} transfer An array of transferable Objects to transfer ownership of.\n */\nfunction Transfer(message, transfer) {\n  this.message = message;\n  this.transfer = transfer;\n}\n\nmodule.exports = Transfer;\n","/**\n * worker must be started as a child process or a web worker.\n * It listens for RPC messages from the parent process.\n */\nvar Transfer = require('./transfer');\n\n/**\n * Special message sent by parent which causes the worker to terminate itself.\n * Not a \"message object\"; this string is the entire message.\n */\nvar TERMINATE_METHOD_ID = '__workerpool-terminate__';\n\n// var nodeOSPlatform = require('./environment').nodeOSPlatform;\n\n// create a worker API for sending and receiving messages which works both on\n// node.js and in the browser\nvar worker = {\n  exit: function() {}\n};\nif (typeof self !== 'undefined' && typeof postMessage === 'function' && typeof addEventListener === 'function') {\n  // worker in the browser\n  worker.on = function (event, callback) {\n    addEventListener(event, function (message) {\n      callback(message.data);\n    })\n  };\n  worker.send = function (message) {\n    postMessage(message);\n  };\n}\nelse if (typeof process !== 'undefined') {\n  // node.js\n\n  var WorkerThreads;\n  try {\n    WorkerThreads = require('worker_threads');\n  } catch(error) {\n    if (typeof error === 'object' && error !== null && error.code === 'MODULE_NOT_FOUND') {\n      // no worker_threads, fallback to sub-process based workers\n    } else {\n      throw error;\n    }\n  }\n\n  if (WorkerThreads &&\n    /* if there is a parentPort, we are in a WorkerThread */\n    WorkerThreads.parentPort !== null) {\n    var parentPort  = WorkerThreads.parentPort;\n    worker.send = parentPort.postMessage.bind(parentPort);\n    worker.on = parentPort.on.bind(parentPort);\n    worker.exit = process.exit.bind(process);\n  } else {\n    worker.on = process.on.bind(process);\n    // ignore transfer argument since it is not supported by process\n    worker.send = function (message) {\n      process.send(message);\n    };\n    // register disconnect handler only for subprocess worker to exit when parent is killed unexpectedly\n    worker.on('disconnect', function () {\n      process.exit(1);\n    });\n    worker.exit = process.exit.bind(process);\n  }\n}\nelse {\n  throw new Error('Script must be executed as a worker');\n}\n\nfunction convertError(error) {\n  return Object.getOwnPropertyNames(error).reduce(function(product, name) {\n    return Object.defineProperty(product, name, {\n\tvalue: error[name],\n\tenumerable: true\n    });\n  }, {});\n}\n\n/**\n * Test whether a value is a Promise via duck typing.\n * @param {*} value\n * @returns {boolean} Returns true when given value is an object\n *                    having functions `then` and `catch`.\n */\nfunction isPromise(value) {\n  return value && (typeof value.then === 'function') && (typeof value.catch === 'function');\n}\n\n// functions available externally\nworker.methods = {};\n\n/**\n * Execute a function with provided arguments\n * @param {String} fn     Stringified function\n * @param {Array} [args]  Function arguments\n * @returns {*}\n */\nworker.methods.run = function run(fn, args) {\n  var f = new Function('return (' + fn + ').apply(null, arguments);');\n  return f.apply(f, args);\n};\n\n/**\n * Get a list with methods available on this worker\n * @return {String[]} methods\n */\nworker.methods.methods = function methods() {\n  return Object.keys(worker.methods);\n};\n\n/**\n * Custom handler for when the worker is terminated.\n */\nworker.terminationHandler = undefined;\n\n/**\n * Cleanup and exit the worker.\n * @param {Number} code \n * @returns \n */\nworker.cleanupAndExit = function(code) {\n  var _exit = function() {\n    worker.exit(code);\n  }\n\n  if(!worker.terminationHandler) {\n    return _exit();\n  }\n\n  var result = worker.terminationHandler(code);\n  if (isPromise(result)) {\n    result.then(_exit, _exit);\n  } else {\n    _exit();\n  }\n}\n\nvar currentRequestId = null;\n\nworker.on('message', function (request) {\n  if (request === TERMINATE_METHOD_ID) {\n    return worker.cleanupAndExit(0);\n  }\n  try {\n    var method = worker.methods[request.method];\n\n    if (method) {\n      currentRequestId = request.id;\n      \n      // execute the function\n      var result = method.apply(method, request.params);\n\n      if (isPromise(result)) {\n        // promise returned, resolve this and then return\n        result\n            .then(function (result) {\n              if (result instanceof Transfer) {\n                worker.send({\n                  id: request.id,\n                  result: result.message,\n                  error: null\n                }, result.transfer);\n              } else {\n                worker.send({\n                  id: request.id,\n                  result: result,\n                  error: null\n                });\n              }\n              currentRequestId = null;\n            })\n            .catch(function (err) {\n              worker.send({\n                id: request.id,\n                result: null,\n                error: convertError(err)\n              });\n              currentRequestId = null;\n            });\n      }\n      else {\n        // immediate result\n        if (result instanceof Transfer) {\n          worker.send({\n            id: request.id,\n            result: result.message,\n            error: null\n          }, result.transfer);\n        } else {\n          worker.send({\n            id: request.id,\n            result: result,\n            error: null\n          });\n        }\n\n        currentRequestId = null;\n      }\n    }\n    else {\n      throw new Error('Unknown method \"' + request.method + '\"');\n    }\n  }\n  catch (err) {\n    worker.send({\n      id: request.id,\n      result: null,\n      error: convertError(err)\n    });\n  }\n});\n\n/**\n * Register methods to the worker\n * @param {Object} [methods]\n * @param {WorkerRegisterOptions} [options]\n */\nworker.register = function (methods, options) {\n\n  if (methods) {\n    for (var name in methods) {\n      if (methods.hasOwnProperty(name)) {\n        worker.methods[name] = methods[name];\n      }\n    }\n  }\n\n  if (options) {\n    worker.terminationHandler = options.onTerminate;\n  }\n\n  worker.send('ready');\n};\n\nworker.emit = function (payload) {\n  if (currentRequestId) {\n    if (payload instanceof Transfer) {\n      worker.send({\n        id: currentRequestId,\n        isEvent: true,\n        payload: payload.message\n      }, payload.transfer);\n      return;\n    }\n\n    worker.send({\n      id: currentRequestId,\n      isEvent: true,\n      payload\n    });\n  }\n};\n\nif (typeof exports !== 'undefined') {\n  exports.add = worker.register;\n  exports.emit = worker.emit;\n}\n","var environment = require('./environment');\n\n/**\n * Create a new worker pool\n * @param {string} [script]\n * @param {WorkerPoolOptions} [options]\n * @returns {Pool} pool\n */\nexports.pool = function pool(script, options) {\n  var Pool = require('./Pool');\n\n  return new Pool(script, options);\n};\n\n/**\n * Create a worker and optionally register a set of methods to the worker.\n * @param {Object} [methods]\n * @param {WorkerRegisterOptions} [options]\n */\nexports.worker = function worker(methods, options) {\n  var worker = require('./worker');\n  worker.add(methods, options);\n};\n\n/**\n * Sends an event to the parent worker pool.\n * @param {any} payload \n */\nexports.workerEmit = function workerEmit(payload) {\n  var worker = require('./worker');\n  worker.emit(payload);\n};\n\n/**\n * Create a promise.\n * @type {Promise} promise\n */\nexports.Promise = require('./Promise');\n\n/**\n * Create a transfer object.\n * @type {Transfer} transfer\n */\nexports.Transfer = require('./transfer');\n\nexports.platform = environment.platform;\nexports.isMainThread = environment.isMainThread;\nexports.cpus = environment.cpus;"],"names":["isNode","nodeProcess","versions","node","module","exports","platform","process","worker_threads","require","isMainThread","connected","Window","cpus","self","navigator","hardwareConcurrency","length","Promise","handler","parent","me","SyntaxError","_onSuccess","_onFail","resolved","rejected","pending","_process","onSuccess","onFail","push","then","resolve","reject","s","_then","f","_resolve","result","forEach","fn","_reject","error","cancel","CancellationError","timeout","delay","timer","setTimeout","TimeoutError","always","clearTimeout","callback","res","prototype","all","promises","remaining","results","p","i","defer","resolver","promise","message","stack","Error","constructor","name","_Promise","validateOptions","options","allowedOptionNames","objectName","optionNames","Object","keys","unknownOptionName","find","optionName","includes","illegalOptionName","allowedOptionName","workerOptsNames","forkOptsNames","workerThreadOptsNames","embeddedWorker","require$$0","environment","require$$1","require$$2","TERMINATE_METHOD_ID","ensureWorkerThreads","WorkerThreads","tryRequireWorkerThreads","ensureWebWorker","Worker","code","getDefaultWorker","Blob","window","URL","createObjectURL","blob","require$$3","type","__dirname","setupWorker","script","workerType","setupBrowserWorker","workerOpts","setupWorkerThreadWorker","workerThreadOpts","setupProcessWorker","resolveForkOptions","worker","isBrowserWorker","on","event","addEventListener","data","send","transfer","postMessage","workerThreadOptions","stdout","stderr","isWorkerThread","kill","terminate","disconnect","child_process","forkOpts","fork","forkArgs","call","isChildProcess","opts","processExecArgv","execArgv","join","inspectorActive","indexOf","debugBrk","debugPort","arg","assign","concat","objectToError","obj","temp","props","WorkerHandler","_options","workerTerminateTimeout","ready","requestQueue","response","terminated","dispatchQueuedRequests","id","task","processing","undefined","isEvent","payload","terminating","onError","create","request","splice","exitCode","signalCode","spawnargs","spawnfile","cleaning","terminationHandler","lastId","methods","exec","method","params","catch","terminateAndNotify","err","busy","force","cleanup","removeAllListeners","killed","cleanExitTimeout","once","WorkerHandlerModule","_tryRequireWorkerThreads","_setupProcessWorker","_setupBrowserWorker","_setupWorkerThreadWorker","MAX_PORTS","debugPortAllocator","DebugPortAllocator","ports","nextAvailableStartingAt","starting","releasePort","port","DEBUG_PORT_ALLOCATOR","Pool","workers","tasks","freeze","debugPortStart","nodeWorker","maxQueueSize","Infinity","onCreateWorker","onTerminateWorker","validateMaxWorkers","maxWorkers","Math","max","minWorkers","validateMinWorkers","_ensureMinWorkers","_boundNext","_next","bind","Array","isArray","TypeError","originalTimeout","String","proxy","arguments","pool","slice","_getWorker","shift","_removeWorker","_createWorkerHandler","_removeWorkerFromList","index","removeWorker","termPromise","stats","totalWorkers","busyWorkers","filter","idleWorkers","pendingTasks","activeTasks","overriddenParams","isNumber","isInteger","value","round","Pool_1","Transfer","exit","parentPort","convertError","getOwnPropertyNames","reduce","product","defineProperty","enumerable","isPromise","run","args","Function","apply","cleanupAndExit","_exit","currentRequestId","register","hasOwnProperty","onTerminate","emit","add","src","workerEmit","require$$4"],"mappings":"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"}